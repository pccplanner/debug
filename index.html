<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script Compare & Patch</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            padding: 20px;
            margin: 0;
            background: #0d1117;
            color: #c9d1d9;
            max-width: 100%;
            overflow-x: hidden;
        }

        h1 {
            text-align: center;
            font-size: 24px;
            color: #c9d1d9;
            margin-bottom: 20px;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 100%;
        }

        @media (min-width: 768px) {
            .container {
                flex-direction: row;
            }
        }

        .input-section {
            flex: 1;
            min-width: 0;
        }

        .input-section h2 {
            font-size: 16px;
            font-weight: 600;
            color: #c9d1d9;
            margin-bottom: 8px;
        }

        .code-container {
            position: relative;
            display: flex;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            flex: 1;
        }

        .line-numbers {
            background: #161b22;
            padding: 10px 5px;
            text-align: right;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 12px;
            color: #8b949e;
            user-select: none;
            width: 40px;
            flex-shrink: 0;
            line-height: 21px; /* Matches textarea */
            border-right: 1px solid #30363d;
            overflow-y: scroll;
        }

        .code-content {
            flex: 1;
            position: relative;
        }

        textarea, .code-pre {
            width: 100%;
            height: 200px;
            padding: 10px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 14px;
            box-sizing: border-box;
            margin: 0;
            border: none;
            line-height: 21px; /* Fixed value to match calculated 14px * 1.5 */
            background: #21262d;
            color: #c9d1d9;
            overflow-x: auto;
            overflow-y: auto;
            resize: none;
            min-height: 100px;
            min-width: 200px;
        }

        .buttons {
            margin: 20px 0;
            text-align: center;
        }

        button {
            padding: 8px 16px;
            margin: 0 8px;
            cursor: pointer;
            background: #238636;
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }

        button:hover {
            background: #2ea44f;
        }

        #output {
            margin-top: 20px;
        }

        #result {
            background: #21262d;
            padding: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5em;
        }

        .added { color: #2ea44f; }
        .removed { color: #f85149; }
        .conflict { color: #fbbf24; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Script Compare & Patch</h1>
    <div class="container">
        <div class="input-section">
            <h2>Original Script</h2>
            <div class="code-container" id="original-container">
                <div class="line-numbers" id="original-lines"></div>
                <div class="code-content">
                    <textarea id="original" placeholder="Paste your original script here" wrap="off" oninput="updateLineNumbers('original')" onscroll="syncScroll('original')" onmousedown="startResize(event, 'original')" ontouchstart="startResize(event, 'original')"></textarea>
                </div>
            </div>
        </div>
        <div class="input-section">
            <h2>Patch Script</h2>
            <div class="code-container" id="patch-container">
                <div class="line-numbers" id="patch-lines"></div>
                <div class="code-content">
                    <textarea id="patch" placeholder="Paste your patch script here" wrap="off" oninput="updateLineNumbers('patch')" onscroll="syncScroll('patch')" onmousedown="startResize(event, 'patch')" ontouchstart="startResize(event, 'patch')"></textarea>
                </div>
            </div>
        </div>
    </div>
    <div class="buttons">
        <button onclick="compareScripts()">Compare</button>
        <button onclick="applyPatch()">Apply Patch</button>
        <button onclick="mergeScripts()">Merge</button>
    </div>
    <div id="output">
        <h2>Result</h2>
        <div class="code-container" id="result-container">
            <div class="line-numbers" id="result-lines"></div>
            <div class="code-content">
                <pre id="result" class="code-pre"></pre>
            </div>
        </div>
    </div>
    <script>
        let isResizing = false;
        let currentResizePanel = '';
        let startX, startY;
        let lineHeight = 21;

        function startResize(event, panel) {
            isResizing = true;
            currentResizePanel = panel;

            if (event.type === 'mousedown') {
                startX = event.clientX;
                startY = event.clientY;
                document.addEventListener('mousemove', resizePanel);
                document.addEventListener('mouseup', stopResize);
            } else if (event.type === 'touchstart') {
                const touch = event.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
                document.addEventListener('touchmove', resizePanel);
                document.addEventListener('touchend', stopResize);
            }
            event.preventDefault();
        }

        function resizePanel(event) {
            if (!isResizing) return;

            let clientX, clientY;
            if (event.type === 'mousemove') {
                clientX = event.clientX;
                clientY = event.clientY;
            } else if (event.type === 'touchmove') {
                const touch = event.touches[0];
                clientX = touch.clientX;
                clientY = touch.clientY;
            }

            const panel = document.getElementById(currentResizePanel);
            const rect = panel.getBoundingClientRect();
            const newWidth = Math.max(200, rect.width + (clientX - startX));
            const newHeight = Math.max(100, rect.height + (clientY - startY));

            panel.style.width = newWidth + 'px';
            panel.style.height = newHeight + 'px';
            startX = clientX;
            startY = clientY;
        }

        function stopResize(event) {
            isResizing = false;
            if (event.type === 'mouseup') {
                document.removeEventListener('mousemove', resizePanel);
                document.removeEventListener('mouseup', stopResize);
            } else if (event.type === 'touchend') {
                document.removeEventListener('touchmove', resizePanel);
                document.removeEventListener('touchend', stopResize);
            }
        }

        function updateLineNumbers(id) {
            const textarea = document.getElementById(id);
            const linesDiv = document.getElementById(id + '-lines');
            const lines = textarea.value.split('\n').length;

            linesDiv.innerHTML = '';
            for (let i = 1; i <= lines; i++) {
                linesDiv.innerHTML += i + '\n';
            }
        }

        function syncScroll(id) {
            const textarea = document.getElementById(id);
            const linesDiv = document.getElementById(id + '-lines');
            linesDiv.scrollTop = textarea.scrollTop;
        }

        function compareScripts() {
            const original = document.getElementById('original').value.split('\n');
            const patch = document.getElementById('patch').value.split('\n');
            const result = document.getElementById('result');
            
            let diff = [];
            for (let i = 0; i < Math.max(original.length, patch.length); i++) {
                if (original[i] === patch[i]) {
                    diff.push(`  ${original[i] || ''}`);
                } else {
                    if (original[i]) diff.push(`<span class="removed">- ${original[i]}</span>`);
                    if (patch[i]) diff.push(`<span class="added">+ ${patch[i]}</span>`);
                }
            }
            
            result.innerHTML = diff.join('\n');
        }

        function applyPatch() {
            const patch = document.getElementById('patch').value;
            document.getElementById('original').value = patch;
            document.getElementById('result').innerHTML = 'Patch applied to original script!';
        }

        function mergeScripts() {
            const original = document.getElementById('original').value.split('\n');
            const patch = document.getElementById('patch').value.split('\n');
            const result = document.getElementById('result');
            
            let merged = [];
            for (let i = 0; i < Math.max(original.length, patch.length); i++) {
                if (original[i] === patch[i]) {
                    merged.push(original[i] || '');
                } else {
                    if (original[i]) merged.push(`<<<<<<< ORIGINAL\n${original[i]}`);
                    if (patch[i]) merged.push(`${patch[i]}\n>>>>>>> PATCH`);
                }
            }
            
            result.innerHTML = merged.join('\n');
        }

        window.onload = function() {
            updateLineNumbers('original');
            updateLineNumbers('patch');
        };
    </script>
</body>
</html>