<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script Manager Tool</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #0d1117;
            color: #c9d1d9;
            display: flex;
            height: 100vh;
            flex-direction: column;
            overflow: hidden;
        }
        h1 { font-size: 20px; text-align: center; margin: 10px; }
        .container { display: flex; flex-direction: column; flex: 1; padding: 10px; gap: 10px; overflow: hidden; }
        .header-section { position: sticky; top: 0; z-index: 10; background: #0d1117; }
        .search-bar { padding: 5px; background: #161b22; border: 1px solid #30363d; border-radius: 6px; margin-bottom: 5px; }
        .search-bar input { width: 100%; padding: 5px; background: #21262d; color: #c9d1d9; border: 1px solid #30363d; border-radius: 4px; font-size: 12px; }
        .toolbar { display: flex; gap: 5px; padding: 5px; background: #161b22; border-bottom: 1px solid #30363d; }
        .toolbar label, .toolbar button { padding: 5px 10px; background: #238636; color: #fff; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .toolbar label:hover, .toolbar button:hover { background: #2ea44f; }
        .editor-wrapper { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .code-container { display: flex; background: #21262d; border: 1px solid #30363d; border-radius: 6px; }
        #original-container, #patch-container { flex: 1 1 50%; min-height: 100px; }
        .splitter { height: 5px; background: #30363d; cursor: ns-resize; display: flex; justify-content: center; align-items: center; }
        .splitter-handle { width: 40px; height: 5px; background: #8b949e; border-radius: 3px; }
        .line-numbers { width: 40px; background: #161b22; padding: 10px 5px; text-align: right; font-size: 12px; color: #8b949e; border-right: 1px solid #30363d; user-select: none; }
        textarea { width: 100%; height: 100%; padding: 10px; background: #21262d; color: #c9d1d9; border: none; resize: none; overflow-y: auto; font-family: Menlo, monospace; font-size: 14px; line-height: 21px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1>Script Manager Tool</h1>
            <div class="search-bar"><input id="search" placeholder="Search (regex)" oninput="searchInScript()"></div>
            <div class="toolbar">
                <label for="file-input-original">Load Original</label><input id="file-input-original" type="file" accept=".txt" onchange="loadFileContent('original')">
                <label for="file-input-patch">Load Patch</label><input id="file-input-patch" type="file" accept=".txt" onchange="loadFileContent('patch')">
                <button onclick="compareScripts()">Compare</button><button onclick="applyPatch()">Apply Patch</button>
                <button onclick="mergeScripts()">Merge</button><button onclick="clearContent()">Clear</button>
                <button onclick="saveProject()">Save</button><button onclick="undo()">Undo</button>
            </div>
        </div>
        <div class="editor-wrapper">
            <div class="code-container" id="original-container">
                <div class="line-numbers" id="original-lines"></div>
                <textarea id="original" placeholder="Original script..." oninput="updateLineNumbers('original'); autoSuggest()"></textarea>
            </div>
            <div class="splitter"><div class="splitter-handle"></div></div>
            <div class="code-container" id="patch-container">
                <div class="line-numbers" id="patch-lines"></div>
                <textarea id="patch" placeholder="Patch script..." oninput="updateLineNumbers('patch'); autoSuggest()"></textarea>
            </div>
        </div>
    </div>

    <script>
        let history = [], isResizing=false, startY, startHeightTop, startHeightBottom, splitter=null;

        function loadFileContent(panel) {
            const file = document.getElementById(`file-input-${panel}`).files[0];
            if (!file) return;
            new FileReader().onload = e => {
                document.getElementById(panel).value = e.target.result;
                updateLineNumbers(panel);
                saveToHistory();
            };
            new FileReader().readAsText(file);
        }

        function updateLineNumbers(id) {
            const ta=document.getElementById(id), linesDiv=document.getElementById(id+'-lines');
            const count=ta.value.split('\n').length || 1;
            linesDiv.textContent = Array.from({length:count},(_,i)=>i+1).join('\n');
            linesDiv.scrollTop = ta.scrollTop;
        }

        function saveToHistory() {
            history.push({ original:document.getElementById("original").value, patch:document.getElementById("patch").value });
            if(history.length>20) history.shift();
        }

        function undo() {
            if(history.length>1) {
                history.pop();
                const prev=history[history.length-1];
                document.getElementById("original").value = prev.original;
                document.getElementById("patch").value = prev.patch;
                updateLineNumbers("original"); updateLineNumbers("patch");
            }
        }

        function autoSuggest() {
            const orig=document.getElementById("original").value;
            const patchEl=document.getElementById("patch");
            if(orig && !patchEl.value) patchEl.placeholder = generatePatchSuggestions(orig).join("\n");
            else patchEl.placeholder = "";
        }

        function generatePatchSuggestions(content) {
            return content.split("\n").map(line=> line.includes("function")?`// Modified ${line}`:line).slice(0,5);
        }

        function searchInScript() {
            try {
                const regex=new RegExp(document.getElementById("search").value,"gi");
                document.getElementById("original").scrollTop = document.getElementById("original").value.search(regex);
                document.getElementById("patch").scrollTop = document.getElementById("patch").value.search(regex);
            } catch{}
        }

        function compareScripts() { navigateToChanges(); saveToHistory(); }
        function navigateToChanges() { searchInScript(); }
        function applyPatch() {
            const patch=document.getElementById("patch").value;
            if(patch) {
                document.getElementById("original").value = patch;
                document.getElementById("patch").value = "";
                updateLineNumbers("original"); updateLineNumbers("patch");
                saveToHistory();
            }
        }
        function mergeScripts() {
            const orig=document.getElementById("original").value.split("\n"), patch=document.getElementById("patch").value.split("\n");
            document.getElementById("original").value = orig.map((l,i)=>patch[i]||l).join("\n");
            document.getElementById("patch").value=""; updateLineNumbers("original"); updateLineNumbers("patch"); saveToHistory();
        }
        function clearContent() { document.getElementById("original").value=""; document.getElementById("patch").value=""; updateLineNumbers("original"); updateLineNumbers("patch"); saveToHistory(); }
        function saveProject() { localStorage.setItem('scriptProject', JSON.stringify({ original:document.getElementById("original").value, patch:document.getElementById("patch").value })); alert("Project Saved!"); }

        window.onload = () => {
            const saved=JSON.parse(localStorage.getItem('scriptProject')||'{}');
            document.getElementById("original").value = saved.original||"";
            document.getElementById("patch").value = saved.patch||"";
            updateLineNumbers("original"); updateLineNumbers("patch");
        };
    </script>
</body>

</html>