<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script Manager Tool</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #0d1117;
            color: #c9d1d9;
            display: flex;
            height: 100vh;
            flex-direction: column;
        }

        h1 {
            font-size: 24px;
            text-align: center;
            margin: 20px;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            flex: 1;
        }

        .code-container {
            display: flex;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            height: 40vh;
            overflow: hidden;
            position: relative;
        }

        .line-numbers {
            width: 40px;
            background: #161b22;
            padding: 10px 5px;
            text-align: right;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 12px;
            color: #8b949e;
            line-height: 21px;
            border-right: 1px solid #30363d;
            overflow-y: auto;
            white-space: pre;
            flex-shrink: 0;
        }

        .code-content {
            flex: 1;
            position: relative;
        }

        textarea {
            width: 100%;
            height: 100%;
            padding: 10px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 14px;
            line-height: 21px;
            background: #21262d;
            color: #c9d1d9;
            border: none;
            box-sizing: border-box;
            overflow-y: auto;
            resize: none;
        }

        .buttons {
            display: flex;
            flex-wrap: wrap; /* Allows wrapping for smaller screens */
            gap: 10px;
            justify-content: space-between; /* Ensures buttons are evenly spaced */
            margin: 20px;
        }

        button {
            padding: 8px 16px;
            margin: 0 8px;
            cursor: pointer;
            background: #238636;
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 14px;  /* Smaller font size */
            font-weight: 600;
            transition: background 0.2s;
            width: 100%; /* Default to full width for mobile devices */
            max-width: 160px; /* Maximum button width for desktop */
        }

        button:hover {
            background: #2ea44f;
        }

        .file-input {
            margin-bottom: 20px;
        }

        .search-bar {
            padding: 10px;
            background: #161b22;
            color: #8b949e;
            border: 1px solid #30363d;
            border-radius: 6px;
        }

        .search-bar input {
            width: 100%;
            padding: 5px;
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            border-radius: 4px;
        }

    </style>
</head>
<body>
    <h1>Script Manager Tool</h1>
    <div class="container">
        <!-- File Import Section -->
        <div class="file-input">
            <input type="file" id="file-input-original" accept=".txt" onchange="loadFileContent('original')">
            <input type="file" id="file-input-patch" accept=".txt" onchange="loadFileContent('patch')">
        </div>

        <div class="search-bar">
            <input type="text" id="search" placeholder="Search functions or keywords" oninput="searchInScript()">
        </div>

        <!-- Code Container for Original Script -->
        <div class="code-container" id="original-container">
            <div class="line-numbers" id="original-lines"></div>
            <div class="code-content">
                <textarea id="original" placeholder="Paste your original script here..." oninput="updateLineNumbers('original')"></textarea>
            </div>
        </div>

        <!-- Code Container for Patch Script -->
        <div class="code-container" id="patch-container">
            <div class="line-numbers" id="patch-lines"></div>
            <div class="code-content">
                <textarea id="patch" placeholder="Paste your patch script here..." oninput="updateLineNumbers('patch')"></textarea>
            </div>
        </div>

        <!-- Buttons for Functions -->
        <div class="buttons">
            <button onclick="compareScripts()">Compare</button>
            <button onclick="applyPatch()">Apply Patch</button>
            <button onclick="mergeScripts()">Merge</button>
            <button onclick="clearContent()">Clear Content</button>
            <button onclick="saveProject()">Save Project</button>
        </div>
    </div>

    <script>
        let lineHeight = 21;

        // Load file content into respective panel (Original/Patch)
        function loadFileContent(panel) {
            const input = document.getElementById(`file-input-${panel}`);
            const file = input.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                document.getElementById(panel).value = e.target.result;
                updateLineNumbers(panel);
                localStorage.setItem(panel + 'Script', e.target.result);  // Save script to local storage
            };

            reader.readAsText(file);
        }

        // Update line numbers dynamically based on script content
        function updateLineNumbers(id) {
            const scriptContent = document.getElementById(id);
            const linesDiv = document.getElementById(id + '-lines');
            const totalLines = scriptContent.value.split("\n").length;
            linesDiv.innerHTML = '';
            for (let i = 1; i <= totalLines; i++) {
                linesDiv.innerHTML += i + "\n";
            }
        }

        // Highlight changes after comparison
        function highlightChanges(original, patch) {
            let highlightedContent = "";
            const changesList = document.getElementById("change-list");

            for (let i = 0; i < Math.max(original.length, patch.length); i++) {
                if (original[i] !== patch[i]) {
                    if (patch[i]) {
                        highlightedContent += `<span class="highlight">${patch[i]}</span>\n`;
                    }
                    if (original[i]) {
                        highlightedContent += `<span class="removed">${original[i]}</span>\n`;
                    }
                } else {
                    highlightedContent += `${original[i] || ''}\n`;
                }
            }

            document.getElementById("original").value = highlightedContent;
        }

        // Smoothly navigate to changed lines
        function scrollToLine(lineIndex) {
            const scriptContent = document.getElementById("original");
            const lines = scriptContent.value.split("\n");
            const scrollPosition = lineIndex * lineHeight;
            scriptContent.scrollTop = scrollPosition;
        }

        // Compare Original and Patch script
        function compareScripts() {
            const original = document.getElementById("original").value.split("\n");
            const patch = document.getElementById("patch").value.split("\n");

            highlightChanges(original, patch);
            navigateToChanges(original, patch);  // Smoothly scroll to changes
        }

        // Smoothly scroll to the first change
        function navigateToChanges(original, patch) {
            const changes = document.querySelectorAll('.highlight, .removed');
            if (changes.length > 0) {
                changes[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Apply the Patch to the Original script
        function applyPatch() {
            alert("Patch apply functionality to be implemented.");
        }

        // Merge the Original and Patch scripts
        function mergeScripts() {
            alert("Merge functionality to be implemented.");
        }

        // Clear all content in the panels
        function clearContent() {
            document.getElementById("original").value = "";
            document.getElementById("patch").value = "";
            document.getElementById("original-lines").innerHTML = "";
            document.getElementById("patch-lines").innerHTML = "";
        }

        // Save the current project (Original and Patch scripts) to local storage
        function saveProject() {
            localStorage.setItem('originalScript', document.getElementById("original").value);
            localStorage.setItem('patchScript', document.getElementById("patch").value);
            alert("Project Saved!");
        }

        // Initialize the script editor and load saved project if exists
        window.onload = function() {
            if (localStorage.getItem('originalScript')) {
                document.getElementById("original").value = localStorage.getItem('originalScript');
                updateLineNumbers('original');
            }

            if (localStorage.getItem('patchScript')) {
                document.getElementById("patch").value = localStorage.getItem('patchScript');
                updateLineNumbers('patch');
            }
        };

        // Save content to Local Storage on window close
        window.onbeforeunload = function() {
            localStorage.setItem('originalScript', document.getElementById("original").value);
            localStorage.setItem('patchScript', document.getElementById("patch").value);
        };
    </script>
</body>
</html>