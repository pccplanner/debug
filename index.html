<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Script Manager Tool</title>
<style>
    /* (unchanged CSS from your original CodeMixer_V3.0) */
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial; margin:0; padding:0; background:#0d1117; color:#c9d1d9; display:flex; height:100vh; flex-direction:column; }
    .header-section { position:sticky; top:0; background:#0d1117; padding:10px; z-index:10; }
    .toolbar { display:flex; gap:5px; background:#161b22; padding:5px; border-bottom:1px solid #30363d; }
    .editor-wrapper { flex:1; display:flex; flex-direction:column; }
    .code-container { display:flex; background:#21262d; border:1px solid #30363d; border-radius:6px; }
    #original-container, #patch-container { flex:1 1 50%; min-height:100px; }
    .splitter { height:5px; cursor:ns-resize; background:#30363d; }
    textarea { width:100%; height:100%; padding:10px; background:#21262d; color:#c9d1d9; border:none; resize:none; font-family:Menlo,monospace; }
    .line-numbers { width:40px; background:#161b22; text-align:right; padding:10px 5px; border-right:1px solid #30363d; color:#8b949e; user-select:none; }
</style>
</head>
<body>
<div class="header-section">
    <h1>Script Manager Tool</h1>
    <div class="toolbar">
        <label for="file-input-original">Load Original<input id="file-input-original" type="file" accept=".txt" onchange="loadFileContent('original')"></label>
        <label for="file-input-patch">Load Patch<input id="file-input-patch" type="file" accept=".txt" onchange="loadFileContent('patch')"></label>
        <button onclick="compareScripts()">Compare</button>
        <button onclick="applyPatch()">Apply Patch</button>
        <button onclick="mergeScripts()">Merge</button>
        <button onclick="clearContent()">Clear</button>
        <button onclick="saveProject()">Save</button>
        <button onclick="undo()">Undo</button>
    </div>
</div>
<div class="editor-wrapper">
    <div class="code-container" id="original-container">
        <div class="line-numbers" id="original-lines"></div>
        <textarea id="original" placeholder="Original script..." oninput="updateLineNumbers('original')"></textarea>
    </div>
    <div class="splitter"></div>
    <div class="code-container" id="patch-container">
        <div class="line-numbers" id="patch-lines"></div>
        <textarea id="patch" placeholder="Patch script..." oninput="updateLineNumbers('patch')"></textarea>
    </div>
</div>

<script>
let history = [], isResizing=false, startY, startHeightTop, startHeightBottom;

function loadFileContent(panel) {
    const file = document.getElementById(`file-input-${panel}`).files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        document.getElementById(panel).value = e.target.result;
        updateLineNumbers(panel);
        saveToHistory();
    };
    reader.readAsText(file);
}

function updateLineNumbers(id) {
    const ta = document.getElementById(id), linesDiv = document.getElementById(id+'-lines');
    const count = ta.value.split('\n').length || 1;
    linesDiv.textContent = Array.from({length:count}, (_,i) => i+1).join('\n');
    linesDiv.scrollTop = ta.scrollTop;
}

function saveToHistory() {
    history.push({ original: document.getElementById("original").value, patch: document.getElementById("patch").value });
    if (history.length > 20) history.shift();
}

function undo() {
    if (history.length > 1) {
        history.pop();
        const prev = history[history.length-1];
        document.getElementById("original").value = prev.original;
        document.getElementById("patch").value = prev.patch;
        updateLineNumbers("original");
        updateLineNumbers("patch");
    }
}

function compareScripts() { navigateToChanges(); saveToHistory(); }
function navigateToChanges() {
    const regex = new RegExp(document.getElementById("search")?.value || '.', 'gi');
    document.getElementById("original").scrollTop = document.getElementById("original").value.search(regex);
    document.getElementById("patch").scrollTop = document.getElementById("patch").value.search(regex);
}

function applyPatch() {
    const p = document.getElementById("patch").value;
    if (p) {
        document.getElementById("original").value = p;
        document.getElementById("patch").value = "";
        updateLineNumbers("original");
        updateLineNumbers("patch");
        saveToHistory();
    }
}

function mergeScripts() {
    const orig = document.getElementById("original").value.split('\n'), patch = document.getElementById("patch").value.split('\n');
    document.getElementById("original").value = orig.map((l,i)=>patch[i]||l).join('\n');
    document.getElementById("patch").value = "";
    updateLineNumbers("original"); updateLineNumbers("patch"); saveToHistory();
}

function clearContent() {
    document.getElementById("original").value = "";
    document.getElementById("patch").value = "";
    updateLineNumbers("original"); updateLineNumbers("patch"); saveToHistory();
}

function saveProject() {
    localStorage.setItem('scriptProject', JSON.stringify({
        original: document.getElementById("original").value,
        patch: document.getElementById("patch").value
    }));
    alert("Project Saved!");
}

// Splitter
document.querySelector('.splitter').addEventListener('mousedown', startResize);
function startResize(e) {
    isResizing = true; startY = e.clientY;
    const top = document.getElementById('original-container'), bottom = document.getElementById('patch-container');
    startHeightTop = top.offsetHeight; startHeightBottom = bottom.offsetHeight;
    window.addEventListener('mousemove', resizePanels);
    window.addEventListener('mouseup', stopResize);
}
function resizePanels(e) {
    if (!isResizing) return;
    const total = startHeightTop + startHeightBottom, delta = e.clientY - startY;
    const newTop = Math.max(100, Math.min(startHeightTop+delta, total-100));
    document.getElementById('original-container').style.flex = `0 0 ${newTop}px`;
    document.getElementById('patch-container').style.flex = `0 0 ${total-newTop}px`;
    updateLineNumbers('original'); updateLineNumbers('patch');
}
function stopResize() {
    isResizing = false;
    window.removeEventListener('mousemove', resizePanels);
    window.removeEventListener('mouseup', stopResize);
}

window.onload = () => {
    const saved = JSON.parse(localStorage.getItem('scriptProject')||'{}');
    document.getElementById("original").value = saved.original||"";
    document.getElementById("patch").value = saved.patch||"";
    updateLineNumbers("original"); updateLineNumbers("patch");
};
</script>
</body>
</html>